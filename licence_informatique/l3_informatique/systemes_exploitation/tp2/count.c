#include <sys/types.h> // pour pid_t
#include <unistd.h> // pour fork()
#include <stdio.h> // pour printf
#include <stdlib.h> // exit
#include <sys/wait.h> // pour wait()
#include <pthread.h> // pour thread
#define MAX 1000000000
static unsigned long long a=0;


void *count(void *arg) {
    volatile unsigned long long*var = (unsigned long
    long*) arg;
    volatile unsigned long long i;
    for (i = 0; i < MAX; i++)
        *var = *var + 1;
    return NULL;
}

// int pthread_create(pthread_t *thread, pthread_attr_t *attr, void *nomfonction, void *arg);

// int pthread_join(pthread_t *thid, void **retour);

// void pthread_exit(void *retour);

// void pthread_cancel(pthread_t tid);

// void pthread_detach(pthread_t thread);

int main() {
    pid_t fils_pid;
    int nbf;
    pthread_t thread;
    printf("nbf : ");
    scanf("\n%d", &nbf);
    // boucle affichant le nombre de fils demandée
    for(int i=0; i<nbf; i++) {
        switch (fils_pid=fork()) {
        case -1: // échec du fork 
            fprintf(stderr, "échec du fork \n");
            perror("fork");
            exit(-1);
        case 0: // code du fils
            printf("mon pid est : %d et le pid pere est : %d \n", getpid(), getppid());
            count(&a);
            printf("a : %lld \n",a);
            exit(0);
        default: // code du père 
            printf("%d : je suis le père, création du fils réussie\n", getpid());
        }
    }
    sleep(4); //laisse le programme tourner pour afficher les zombies
    return 0;
}
